<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Creating New Items</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1">
<link rel="start" href="index.html" title="GooCanvas Reference Manual">
<link rel="up" href="ch01.html" title="Introduction">
<link rel="prev" href="goocanvas-model-view-canvas.html" title="The Model/View Canvas">
<link rel="next" href="ch02.html" title="Core Objects">
<meta name="generator" content="GTK-Doc V1.8 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
<link rel="chapter" href="ch01.html" title="Introduction">
<link rel="chapter" href="ch02.html" title="Core Objects">
<link rel="chapter" href="ch03.html" title="Standard Canvas Items">
<link rel="chapter" href="ch04.html" title="Standard Canvas Item Models">
<link rel="chapter" href="ch05.html" title="Miscellaneous">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="2"><tr valign="middle">
<td><a accesskey="p" href="goocanvas-model-view-canvas.html"><img src="left.png" width="24" height="24" border="0" alt="Prev"></a></td>
<td><a accesskey="u" href="ch01.html"><img src="up.png" width="24" height="24" border="0" alt="Up"></a></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="24" height="24" border="0" alt="Home"></a></td>
<th width="100%" align="center">GooCanvas Reference Manual</th>
<td><a accesskey="n" href="ch02.html"><img src="right.png" width="24" height="24" border="0" alt="Next"></a></td>
</tr></table>
<div class="refentry" lang="en">
<a name="goocanvas-creating-items"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2><span class="refentrytitle">Creating New Items</span></h2>
<p>Creating New Items &#8212; how to create new canvas items.</p>
</td>
<td valign="top" align="right"></td>
</tr></table></div>
<div class="refsect1" lang="en">
<a name="new-items-overview"></a><h2>How to Create New Canvas Items</h2>
<p>
    Here's an example of how to create a new simple canvas item. (Note that
    this item doesn't have a model-view split.)
    </p>
<p>
    Here's the header file - a fairly standard GObject header file.
    Our item derives from <a href="GooCanvasItemSimple.html" title="GooCanvasItemSimple"><span class="type">GooCanvasItemSimple</span></a> and just has its own
    x, y, width and height variables:
    </p>
<div class="informalexample"><pre class="programlisting">
  /*
   * GooCanvas Demo. Copyright (C) 2006 Damon Chaplin.
   * Released under the GNU LGPL license. See COPYING for details.
   *
   * demo-item.c - a simple demo item.
   */
  #ifndef __GOO_DEMO_ITEM_H__
  #define __GOO_DEMO_ITEM_H__
  
  #include &lt;gtk/gtk.h&gt;
  #include "goocanvasitemsimple.h"
  
  G_BEGIN_DECLS
  
  
  #define GOO_TYPE_DEMO_ITEM            (goo_demo_item_get_type&#160;())
  #define GOO_DEMO_ITEM(obj)            (G_TYPE_CHECK_INSTANCE_CAST ((obj), GOO_TYPE_DEMO_ITEM, GooDemoItem))
  #define GOO_DEMO_ITEM_CLASS(klass)    (G_TYPE_CHECK_CLASS_CAST ((klass), GOO_TYPE_DEMO_ITEM, GooDemoItemClass))
  #define GOO_IS_DEMO_ITEM(obj)         (G_TYPE_CHECK_INSTANCE_TYPE ((obj), GOO_TYPE_DEMO_ITEM))
  #define GOO_IS_DEMO_ITEM_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), GOO_TYPE_DEMO_ITEM))
  #define GOO_DEMO_ITEM_GET_CLASS(obj)  (G_TYPE_INSTANCE_GET_CLASS ((obj), GOO_TYPE_DEMO_ITEM, GooDemoItemClass))
  
  
  typedef struct _GooDemoItem       GooDemoItem;
  typedef struct _GooDemoItemClass  GooDemoItemClass;
  
  struct _GooDemoItem
  {
    GooCanvasItemSimple parent_object;
  
    gdouble x, y, width, height;
  };
  
  struct _GooDemoItemClass
  {
    GooCanvasItemSimpleClass parent_class;
  };
  
  
  GType               goo_demo_item_get_type  (void) G_GNUC_CONST;
  
  GooCanvasItem*      goo_demo_item_new       (GooCanvasItem      *parent,
                                               gdouble             x,
                                               gdouble             y,
                                               gdouble             width,
                                               gdouble             height,
                                               ...);
  
  
  G_END_DECLS
  
  #endif /* __GOO_DEMO_ITEM_H__ */
 </pre></div>
<p>
And here's the source file:
</p>
<div class="informalexample"><pre class="programlisting">
  /*
   * GooCanvas Demo. Copyright (C) 2006 Damon Chaplin.
   * Released under the GNU LGPL license. See COPYING for details.
   *
   * demo-item.c - a simple demo item.
   */
  #include &lt;config.h&gt;
  #include "goocanvas.h"
  #include "demo-item.h"
  
  
  /* Use the GLib convenience macro to define the type. GooDemoItem is the
     class struct, goo_demo_item is the function prefix, and our class is a
     subclass of GOO_TYPE_CANVAS_ITEM_SIMPLE. */
  G_DEFINE_TYPE (GooDemoItem, goo_demo_item, GOO_TYPE_CANVAS_ITEM_SIMPLE)
  
  
  /* The standard object initialization function. */
  static void
  goo_demo_item_init (GooDemoItem *demo_item)
  {
    demo_item-&gt;x = 0.0;
    demo_item-&gt;y = 0.0;
    demo_item-&gt;width = 0.0;
    demo_item-&gt;height = 0.0;
  }
  
  
  /* The convenience function to create new items. This should start with a 
     parent argument and end with a variable list of object properties to fit
     in with the standard canvas items. */
  GooCanvasItem*
  goo_demo_item_new (GooCanvasItem      *parent,
                     gdouble             x,
                     gdouble             y,
                     gdouble             width,
                     gdouble             height,
                     ...)
  {
    GooCanvasItem *item;
    GooDemoItem *demo_item;
    const char *first_property;
    va_list var_args;
  
    item = g_object_new (GOO_TYPE_DEMO_ITEM, NULL);
  
    demo_item = (GooDemoItem*) item;
    demo_item-&gt;x = x;
    demo_item-&gt;y = y;
    demo_item-&gt;width = width;
    demo_item-&gt;height = height;
  
    va_start (var_args, height);
    first_property = va_arg (var_args, char*);
    if (first_property)
      g_object_set_valist ((GObject*) item, first_property, var_args);
    va_end (var_args);
  
    if (parent)
      {
        goo_canvas_item_add_child (parent, item, -1);
        g_object_unref (item);
      }
  
    return item;
  }
  
  
  /* The update method. This is called when the canvas is initially shown and
     also whenever the object is updated and needs to change its size and/or
     shape. It should calculate its new bounds in its own coordinate space,
     storing them in simple-&gt;bounds. */
  static void
  goo_demo_item_update  (GooCanvasItemSimple *simple,
                         cairo_t             *cr)
  {
    GooDemoItem *demo_item = (GooDemoItem*) simple;
  
    /* Compute the new bounds. */
    simple-&gt;bounds.x1 = demo_item-&gt;x;
    simple-&gt;bounds.y1 = demo_item-&gt;y;
    simple-&gt;bounds.x2 = demo_item-&gt;x + demo_item-&gt;width;
    simple-&gt;bounds.y2 = demo_item-&gt;y + demo_item-&gt;height;
  }
  
  
  /* The paint method. This should draw the item on the given cairo_t, using
     the item's own coordinate space. */
  static void
  goo_demo_item_paint (GooCanvasItemSimple   *simple,
                       cairo_t               *cr,
                       const GooCanvasBounds *bounds)
  {
    GooDemoItem *demo_item = (GooDemoItem*) simple;
  
    cairo_move_to (cr, demo_item-&gt;x, demo_item-&gt;y);
    cairo_line_to (cr, demo_item-&gt;x, demo_item-&gt;y + demo_item-&gt;height);
    cairo_line_to (cr, demo_item-&gt;x + demo_item-&gt;width,
                   demo_item-&gt;y + demo_item-&gt;height);
    cairo_line_to (cr, demo_item-&gt;x + demo_item-&gt;width, demo_item-&gt;y);
    cairo_close_path (cr);
    goo_canvas_style_set_fill_options (simple-&gt;simple_data-&gt;style, cr);
    cairo_fill (cr);
  }
  
  
  /* Hit detection. This should check if the given coordinate (in the item's
     coordinate space) is within the item. If it is it should return TRUE,
     otherwise it should return FALSE. */
  static gboolean
  goo_demo_item_is_item_at (GooCanvasItemSimple *simple,
                            gdouble              x,
                            gdouble              y,
                            cairo_t             *cr,
                            gboolean             is_pointer_event)
  {
    GooDemoItem *demo_item = (GooDemoItem*) simple;
  
    if (x &lt; demo_item-&gt;x || (x &gt; demo_item-&gt;x + demo_item-&gt;width)
        || y &lt; demo_item-&gt;y || (y &gt; demo_item-&gt;y + demo_item-&gt;height))
      return FALSE;
  
    return TRUE;
  }
  
  
  /* The class initialization function. Here we set the class' update(), paint()
     and is_item_at() methods. */
  static void
  goo_demo_item_class_init (GooDemoItemClass *klass)
  {
    GooCanvasItemSimpleClass *simple_class = (GooCanvasItemSimpleClass*) klass;
  
    simple_class-&gt;update        = goo_demo_item_update;
    simple_class-&gt;paint         = goo_demo_item_paint;
    simple_class-&gt;is_item_at    = goo_demo_item_is_item_at;
  }
  
  
 </pre></div>
</div>
</div>
</body>
</html>
